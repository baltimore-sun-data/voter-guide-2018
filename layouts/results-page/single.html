{{ define "extra-head" }}
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
  <!-- force a refresh every hour -->
  <meta http-equiv="refresh" content="3600">
{{ end }}

{{ define "main" }}
{{ $baseURL := .Param "results-base-url" }}
<div class="primary container">
    <h1 class="section-header-splash grey">{{.Title}}</h1>
    <main class="results-page">
        {{ .Content }}
        <em>
            Last update from
            <a href="https://elections.maryland.gov/elections/results_data/">Board of Elections</a>:
            <span id="boe-update-time">Still loading…</span>
        </em>
    </main>

    <noscript>
      <h2>Warning: This page requires Javascript.</h2>
    </noscript>

    {{ partial "ad-autorefresh.html" . }}

    <button type="button" class="js-key-contests-btn btn btn-primary btn-lg">Refresh</button>
    <div
        class="js-results-container"
        data-fetch-url=''
        data-target="#info"
        data-errors="#errors"
        data-time="#time-all"
        data-boe-update="#boe-update-time"
        data-timeout="30000">

        <h2 class="results-header">Find races</h2>
        <hr>
        <div class="row">
          <div class="find-results col-sm-4 col-xs-12">
            <select class="js-select2">
              <option disabled selected>Choose by race name</option>
              {{ range .Site.Data.results.AllContests }}
                <option value='{{ $baseURL }}contests/{{ .ID }}.html'>
                  {{- .Name -}}
                  {{- if ne .Jurisdiction "State of Maryland" -}}
                    {{- " " -}}{{- .Jurisdiction -}}
                  {{- end -}}
                  {{- if ne .District "State of Maryland" -}}
                    {{- " " -}}{{- .District -}}
                  {{- end -}}
                  {{- if and (ne .Party "Non-Partisan") (ne .Party "Non Partisan") -}}
                    {{- " " -}}({{- .Party -}})
                  {{- end -}}
                </option>
              {{ end }}
            </select>
          </div>
          <div class="find-results col-sm-4 col-xs-12">
            <select class="js-select2">
              <option disabled selected>Choose by candidate name</option>
              {{ range .Site.Data.results.AllOptions }}
                <option value='{{ $baseURL }}contests/{{ .ID }}.html'>
                  {{- .Name -}}
                  {{- " • " }}{{ .Contest -}}
                  {{- " • " }}{{ .District -}}
                </option>
              {{ end }}
            </select>
          </div>
          <div class="find-results col-sm-4 col-xs-12">
            <select class="js-select2">
              <option disabled selected>Choose by district</option>
              {{ range .Site.Data.results.AllDistricts }}
                <option value='{{ $baseURL }}districts/{{ .ID }}.html'>
                  {{- if ne .Jurisdiction "State of Maryland" -}}
                    {{- .Jurisdiction -}}{{- " " -}}
                  {{- end -}}
                  {{- .District -}}
                  {{- if eq .Type "Senatorial District" }} (State Senate){{ end -}}
                </option>
              {{ end }}
            </select>
          </div>
        </div>

        <div class="last-refresh">
          Results last refreshed: <span id="time-all"></span>
        </div>

        <div id="errors"></div>
        <div id="info">
          <p>Select race above</p>
        </div>
    </div>
    <h2 class="results-header">Key races</h2>
    <hr>
    <div class="last-refresh">
      Results last refreshed: <span id="time-key">Still loading…</span>
    </div>
    {{ range $race := .Site.Data.KeyContests2018Primary }}
    <section>
      <div
        class="js-results-container"
        data-fetch-url='{{ $baseURL }}contests/{{ .ID }}.html'
        data-target='#info-{{ $race.ID }}'
        data-errors='#errors-{{ $race.ID }}'
        data-time='#time-key'
        data-boe-update="#boe-update-time"
        data-timeout="30000">
          <div id="errors-{{ $race.ID }}"></div>
          <div id="info-{{ $race.ID }}">
            <p>Loading results…</p>
          </div>
      </div>
    </section>
    {{ end }}

    <button type="button" class="js-key-contests-btn btn btn-primary btn-lg">Refresh</button>

    <div class="newsfeed">
      <h2 class="results-header">Election coverage</h2>
      <!-- TODO: Get proper election day results feed URL -->
      <ul
          data-feed-url="http://www.baltimoresun.com/news/maryland/politics/rss2.0.xml"
          data-refresh="60000">
      </ul>
    </div>
</div>
{{ end }}
