# Voter guide post-mortem

## Overview
`voter-guide-2018` was The Baltimore Sun's repository for a website with voter information and election results for Maryland in 2018. The first commit was made by Adam Marton on January 18, 2018. He handed off the project on February 6. By November 8, there had been 474 commits from 169 pull requests. (I did most of them and Caroline did the rest.) The repo contains information on 841 candidates, with responses from 447, and 436 separate candidate headshots. It also has comprehensive Maryland election results for both the primary and the midterm.

The work on the repository can be broken into three phases. Before April, we were just trying to create a voter guide with questionnaires answered by the various candidates. Before the June 26 primary, we needed to process and show the election results using a JSON feed from the state board of elections. The final phase of work was to separate primary candidates from those who advanced to the general election and show the general election results.

The repository was open source (although not free software, since the Baltimore Sun Media Group retains its copyright on all materials). The voter guide was generated by taking a Google Sheets document, converting it to CSV, and feeding that into [Hugo](https://gohugo.io) (a static site generator), and uploading the resulting files to Amazon S3. The election results worked by taking a JSON feed from the State Board of Elections, generating HTML files from a template, uploading those fragments to S3, and having JavaScript on the frontend poll periodically for changes in the results. Code was a mixture of Go (the CSV converter and results uploader), JavaScript (front end), and Python (image resizing).

## What worked

Using Amazon S3 to deliver static files kept costs down while delivering solid performance even during extreme traffic surges. It was a very good fit for the project.

The static site generator Hugo is still under active development and got better as we went, with some of the later feature additions removing the need for hacks used in earlier parts of the project.

Hosting the code on Github and using Github for code reviews worked well. Code reviews ensured that both developers had a good understanding of what was happening with the code. We had a "CI/CD" (continuous integration/continuous deployment) setup in which code was checked for style issues by Travis CI and deployed by the Tribune Jenkins server. This setup made it quick and easy to update the site.

## What didn't work

The initial frontend code for the site was taken from the 2016 voter guide. The design was fine, but reusing the code meant inheriting a mixture of Bootstrap v3 and non-Bootstrap CSS with no particularly strong conventions, which lead to a lot struggles with CSS. I think next time, the existing site should be taken as a "comp" mockup, but the actual code rewritten from scratch with Bootstrap or whatever other CSS framework in mind from the start.

The project used SCSS and had asset hashing, but had no comprehensive frontend pipeline, which meant that only vanilla ES5 JavaScript could be used. Worse, there was no frontend framework (Vue/React/Angular), so code for the election results page quickly became overwhelming and was difficult to extend when new behaviors were needed. For instance, adding hovering on the county SVGs should have been trivial but was actually somewhat convoluted due to the lack of JS framework. Taking the time to create a working pipeline probably would have paid off later in the project.

Our results pages were taken directly from the State Board of Elections, which meant that when the data was misleading there was no easy way to correct it. For example, in some primary elections, the number of candidates voters could pick and the number of candidates who advanced were not the same, but there was no good way to override the data from SBE.

The site navigation could also be improved. As a voter, it's difficult to know which precinct one is in, and as result, which candidates one can select from. A naive voter might click "Baltimore City" and expect their congressional representative to be listed there, not realizing that it only contains citywide races.

## What was just okay

Google Sheets basically worked, but when we were using CSVs directly, the diffs were unreadable, so we switched to committing JSON instead. This was fine, but could be improved.

The flow for getting responses and headshots out of Survey Monkey resulted in numerous Unicode bugs and was somewhat error prone. Perhaps next time we could take data directly from a Google Forms API.

Linking out to podcasts and endorsements was okay, but it might have been better if it had been incorporated more easily.

Overall, it would be better if simple content changes could be made without developer oversight.

## Areas for future improvement

It would be nice to allow voters to input their address and get a list of candidates for their precinct.

It would be nice to be able link from the state board results to the candidate pages.

It would be good to have more consideration for coverage of questions/referendums.

It would be good to have more ways of embedding elections coverage on the main news site and conversely more ways of linking to the news site from the voter guide.

It could be good to look at ways of enhancing SEO, like AMP or more programmatic feeds and metadata.
